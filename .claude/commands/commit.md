---
model: sonnet
description: 変更を意味のある単位でコミットします。option：[-d (dry-run)]
argument-hint: [-d (dry-run)]

mode: agent
---

# コミット作成

変更内容を意味のある単位で複数のコミットに分割してください。

## 1. 引数のパース

引数は以下のオプションを受け付けます:

- `-d`: dry-runモード（実際のコミットは実行せず、提案のみ行う）

例:

- `/commit` → 通常モード（コミットを実行）
- `/commit -d` → dry-runモード（提案のみ）

## 2. 保護されたブランチのチェック

現在のブランチが保護されたブランチかどうかを確認します。

1. 現在のブランチ名を取得:
```bash
git branch --show-current
```

2. 保護されたブランチ一覧を取得:

下記コマンドの:ownerと:repoには現在のgit URLから取得した情報をそれぞれ入れてください

```bash
gh api repos/:owner/:repo/branches --paginate --jq '.[] | select(.protected) | .name'
```

3. 現在のブランチが保護されたブランチ一覧に含まれている場合:
   - `AskUserQuestion`ツールで新しいブランチ名を提案し、ユーザーに確認
   - 承認された場合: `git checkout -b <ブランチ名>` でブランチを作成し、コミット処理を継続
   - キャンセルされた場合: コミット処理を中断

4. 現在のブランチが保護されていない場合:
   - そのまま次のステップに進む

## 3. dry-runモード

`-d`オプションが指定された場合:

- 絶対に実際のコミットを実行してはいけません。
- どのようにコミットを分割するか、各コミットのメッセージ・変更ファイル名を提示する
- 提案を出力したら、`AskUserQuestion`ツールを使用してコミットを実行するかどうかを確認する
- ユーザーがコミット実行を承認した場合のみ、実際のコミットを実行する
- ユーザーがコミット実行を拒否した場合は、コミットを実行せずに終了する

## 4. 現在の状態確認

```bash
git status
```

## 5. コミット戦略

- ステージング済み・未ステージングにかかわらず、すべての変更を対象にコミットを提案すること
- 同一ファイルがステージング済みと未ステージングに分かれていても、そのファイルの変更は1つのコミットにまとめること
- 変更内容を意味のある単位で複数のコミットに分割すること
- 1つのコミットには1つの目的のみを含める
- コミットの粒度は、コミットメッセージがワンライン（1行）で記述できる範囲に留めること
    - ワンラインで説明しきれない変更は、さらに細かく分割する
- コミットメッセージは日本語で記述する

### 悪い例

```
fix: 複数の不具合を修正
```

### 良い例

```
:bug: ログイン画面でキーボードが閉じない問題を修正
:bug: ユーザー名表示時の文字化けを修正
```

## 6. ステージングの整理

コミットを実行する前に、既存のステージング状態を確認し、必要に応じて整理してください。

```bash
# 既にステージングされているファイルがある場合、一旦すべてアンステージする
git reset HEAD
```

意味のある粒度でコミットを分割するために、各コミットごとに必要なファイルのみをステージングしてください。

## 7. コミット実行

実行前チェック（必須:
- [ ] `-d`オプションが指定されていないことを確認したか？
- [ ] 以前に`/commit -d`を実行したことを理由にコミット実行を許可していないか？（dry-runはあくまで提案であり、ユーザーの明示的な承認なしにコミットを実行してはいけない）

上記のチェックをすべて満たした場合のみ、手順を行ってください。

変更をステージングしてコミットしてください。各コミットは以下の手順で行います：

1. 対象ファイルをステージング: `git add <ファイル>`
2. コミット実行: `git commit -m "<メッセージ>"`
3. 次のコミットのために1-2を繰り返す

## 注意事項

- コミットメッセージは必ず日本語で記述してください
- 関連性のない変更は別々のコミットに分けてください